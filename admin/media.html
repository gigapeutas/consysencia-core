<!doctype html>
<html lang="pt-br">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ConSySencI.A ‚Äî Biblioteca de M√≠dia</title>
  <style>
    :root{--bg:#070A12;--card:#0B1020;--txt:#e8fff4;--mut:rgba(232,255,244,.68);--neon:#35ff9b;--line:rgba(53,255,155,.14);--danger:#ff5a5a;}
    *{box-sizing:border-box;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;}
    body{margin:0;color:var(--txt);background:radial-gradient(900px 600px at 15% 0%, rgba(53,255,155,.10), transparent 60%),var(--bg);}
    header{position:sticky;top:0;background:rgba(7,10,18,.88);border-bottom:1px solid var(--line);backdrop-filter:blur(10px);}
    .wrap{max-width:1100px;margin:0 auto;padding:16px;}
    .top{display:flex;gap:12px;align-items:center;justify-content:space-between;flex-wrap:wrap;}
    h1{margin:0;font-size:14px;letter-spacing:.6px;}
    .card{background:rgba(11,16,32,.86);border:1px solid rgba(53,255,155,.12);border-radius:16px;box-shadow:0 12px 34px rgba(0,0,0,.35);overflow:hidden;}
    .card h2{margin:0;padding:12px 12px 0;font-size:13px;color:rgba(159,231,199,.92);}
    .body{padding:12px;}
    .mut{color:var(--mut);font-size:12px;line-height:1.35;}
    input,textarea,button,select{width:100%;border-radius:12px;border:1px solid rgba(53,255,155,.16);background:rgba(7,10,18,.62);color:var(--txt);padding:10px 11px;outline:none;}
    textarea{min-height:90px;resize:vertical;}
    button{cursor:pointer;font-weight:800;}
    .btn{background:rgba(53,255,155,.16);border:1px solid rgba(53,255,155,.34);}
    .btn:hover{background:rgba(53,255,155,.24);}
    .danger{background:rgba(255,90,90,.12);border:1px solid rgba(255,90,90,.35);}
    .danger:hover{background:rgba(255,90,90,.18);}
    .row{display:grid;grid-template-columns:1fr;gap:10px;}
    @media(min-width:820px){.row.two{grid-template-columns:1fr 1fr;}}
    table{width:100%;border-collapse:collapse;font-size:12px;}
    th,td{border-bottom:1px solid rgba(53,255,155,.10);padding:10px 8px;vertical-align:top;}
    th{text-align:left;color:rgba(159,231,199,.92);font-weight:800;}
    .actions{display:flex;gap:8px;flex-wrap:wrap;}
    .actions button{width:auto;padding:7px 10px;border-radius:10px;}
    a{color:rgba(53,255,155,.95);text-decoration:none}
  </style>
</head>
<body>
<header>
  <div class="wrap top">
    <h1>üñºÔ∏è ConSySencI.A ‚Äî Biblioteca de M√≠dia (links)</h1>
    <div class="actions">
      <a class="btn" style="display:inline-block;padding:9px 12px;border-radius:12px" href="/admin/">Painel Regras</a>
      <button class="btn" onclick="refresh()">‚Üª Atualizar</button>
    </div>
  </div>
</header>

<div class="wrap" style="display:grid;gap:12px;grid-template-columns:1fr;">
  <section class="card">
    <h2>Cadastrar / Editar</h2>
    <div class="body">
      <div class="mut" id="status">Use este painel para registrar links (imagem/PDF/landing). Depois voc√™ referencia pelo alias nas respostas.</div>
      <div style="height:10px"></div>
      <div class="row two">
        <div>
          <div class="mut">Alias (ex: catalogo_geral)</div>
          <input id="alias" placeholder="catalogo_geral" />
        </div>
        <div>
          <div class="mut">Tipo</div>
          <select id="kind">
            <option value="image">image</option>
            <option value="pdf">pdf</option>
            <option value="link">link</option>
          </select>
        </div>
      </div>
      <div style="height:10px"></div>
      <div class="row">
        <div>
          <div class="mut">URL p√∫blica</div>
          <input id="url" placeholder="https://..." />
        </div>
      </div>
      <div style="height:10px"></div>
      <div class="row">
        <div>
          <div class="mut">Descri√ß√£o (opcional)</div>
          <textarea id="desc" placeholder="ex: Cat√°logo geral ‚Äî vers√£o fevereiro"></textarea>
        </div>
      </div>
      <div style="height:10px"></div>
      <div class="actions">
        <button class="btn" onclick="save()">Salvar</button>
        <button class="danger" onclick="clearForm()">Limpar</button>
      </div>
    </div>
  </section>

  <section class="card">
    <h2>Itens</h2>
    <div class="body">
      <table>
        <thead><tr><th>Alias</th><th>Tipo</th><th>URL</th><th>Descri√ß√£o</th><th>A√ß√µes</th></tr></thead>
        <tbody id="tbody"></tbody>
      </table>
    </div>
  </section>
</div>

<script>
  // Este painel espera functions:
  // POST /.netlify/functions/media_list
  // POST /.netlify/functions/media_upsert
  // POST /.netlify/functions/media_delete

  async function api(path, body){
    const r = await fetch(path, { method:"POST", headers:{ "content-type":"application/json" }, body: JSON.stringify(body||{}) });
    const j = await r.json().catch(()=>({}));
    return { ok:r.ok, j };
  }

  function setStatus(t){ document.getElementById("status").textContent = t; }
  function escapeHtml(s){ return String(s||"").replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;"); }

  async function refresh(){
    const out = await api("/.netlify/functions/media_list", { limit: 500 });
    if(!out.ok){ setStatus(out.j.error || "Erro ao listar."); return; }
    render(out.j.items || []);
    setStatus("OK ‚Äî " + (out.j.items?.length||0) + " itens");
  }

  function clearForm(){
    document.getElementById("alias").value="";
    document.getElementById("kind").value="image";
    document.getElementById("url").value="";
    document.getElementById("desc").value="";
  }

  async function save(){
    const alias = (document.getElementById("alias").value||"").trim();
    const kind = document.getElementById("kind").value;
    const url  = (document.getElementById("url").value||"").trim();
    const desc = (document.getElementById("desc").value||"").trim();

    if(!alias || !url){ setStatus("Alias e URL s√£o obrigat√≥rios."); return; }

    const out = await api("/.netlify/functions/media_upsert", { alias, kind, url, desc });
    if(!out.ok){ setStatus(out.j.error || "Erro ao salvar."); return; }
    clearForm();
    await refresh();
  }

  async function del(alias){
    const out = await api("/.netlify/functions/media_delete", { alias });
    if(!out.ok){ setStatus(out.j.error || "Erro ao remover."); return; }
    await refresh();
  }

  function render(items){
    const tb = document.getElementById("tbody");
    tb.innerHTML = "";
    for(const it of items){
      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td>${escapeHtml(it.alias)}</td>
        <td>${escapeHtml(it.kind)}</td>
        <td><a href="${escapeHtml(it.url)}" target="_blank">abrir</a></td>
        <td>${escapeHtml(it.desc||"")}</td>
        <td><button class="danger" onclick="del('${it.alias.replaceAll("'","")}')">Excluir</button></td>
      `;
      tb.appendChild(tr);
    }
  }

  refresh();
</script>
</body>
</html>
