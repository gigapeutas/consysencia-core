<!doctype html>
<html lang="pt-br">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ConSySencI.A — Painel (Admin)</title>
  <meta name="robots" content="noindex,nofollow" />
  <style>
    :root{
      --bg:#05080a; --card:#071014cc; --line:#0f2a22; --txt:#e9fff6; --mut:#9bd8c2;
      --g:#22ff9a; --g2:#0fe28a; --bad:#ff4d6d; --warn:#ffd166;
      --shadow: 0 24px 80px rgba(0,0,0,.55);
      --r:22px;
    }
    *{box-sizing:border-box}
    body{
      margin:0; color:var(--txt); font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial;
      background:
        radial-gradient(1200px 700px at 20% -10%, rgba(34,255,154,.18), transparent 60%),
        radial-gradient(900px 600px at 110% 10%, rgba(15,226,138,.14), transparent 55%),
        radial-gradient(800px 600px at 50% 120%, rgba(34,255,154,.08), transparent 60%),
        linear-gradient(180deg, #030607, #050a0c 55%, #040809);
      min-height:100vh;
    }
    .wrap{max-width:980px;margin:0 auto;padding:22px 18px 70px}
    .top{
      display:flex; align-items:flex-start; justify-content:space-between; gap:14px;
      padding:18px 18px 10px;
    }
    .brand{display:flex; gap:12px; align-items:center}
    .dot{width:12px;height:12px;border-radius:999px;background:var(--g); box-shadow: 0 0 24px rgba(34,255,154,.55)}
    h1{margin:0;font-size:28px;letter-spacing:.2px}
    .sub{margin-top:4px;color:var(--mut);font-size:13px;line-height:1.35}
    .btn{
      appearance:none;border:1px solid rgba(34,255,154,.35); background:linear-gradient(180deg, rgba(34,255,154,.10), rgba(34,255,154,.03));
      color:var(--txt); padding:12px 16px; border-radius:18px; cursor:pointer;
      box-shadow: 0 14px 40px rgba(0,0,0,.35);
      font-weight:650; letter-spacing:.2px;
    }
    .btn:hover{border-color:rgba(34,255,154,.6)}
    .btn.ghost{background:transparent}
    .btn.bad{border-color:rgba(255,77,109,.35); background:linear-gradient(180deg, rgba(255,77,109,.08), rgba(255,77,109,.02))}
    .panel{
      margin-top:10px; padding:18px; border-radius:var(--r); border:1px solid rgba(34,255,154,.18);
      background: linear-gradient(180deg, rgba(7,16,20,.78), rgba(7,16,20,.52));
      box-shadow: var(--shadow);
    }
    .row{display:flex; gap:12px; flex-wrap:wrap; align-items:center}
    .pill{
      display:inline-flex; gap:10px; align-items:center;
      padding:10px 14px; border-radius:999px; border:1px solid rgba(34,255,154,.22);
      background: rgba(0,0,0,.22); color:var(--mut); font-size:13px;
    }
    .mono{font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace}
    .grid{display:grid; grid-template-columns: repeat(12, 1fr); gap:14px; margin-top:14px}
    .card{
      grid-column: span 12;
      padding:16px; border-radius:var(--r); border:1px solid rgba(34,255,154,.16);
      background: linear-gradient(180deg, rgba(0,0,0,.18), rgba(0,0,0,.08));
    }
    .card h2{margin:0 0 6px;font-size:18px}
    .desc{color:var(--mut); font-size:13px; line-height:1.4}
    .card .actions{margin-top:12px; display:flex; gap:10px; flex-wrap:wrap; align-items:center}
    .small{font-size:12px;color:rgba(155,216,194,.9)}
    .msg{
      margin-top:12px; padding:12px 14px; border-radius:16px; border:1px solid rgba(34,255,154,.18);
      background: rgba(0,0,0,.20); color:var(--mut); min-height:44px;
      overflow:auto;
    }
    .danger{color:var(--bad)}
    .ok{color:var(--g)}
    .input{
      width: min(520px, 100%);
      padding:12px 14px;
      border-radius:16px;
      border:1px solid rgba(34,255,154,.22);
      background: rgba(0,0,0,.28);
      color:var(--txt);
      outline:none;
    }
    .input:focus{border-color:rgba(34,255,154,.55)}
    @media (min-width: 860px){
      .card.span6{grid-column: span 6;}
    }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="top">
      <div class="brand">
        <div class="dot"></div>
        <div>
          <h1>ConSySencI.A — Painel</h1>
          <div class="sub">Gestão rápida de events, mídia e automações (Admin)</div>
        </div>
      </div>
      <button class="btn bad" id="logoutBtn">Sair</button>
    </div>

    <div class="panel">
      <div class="row" style="margin-bottom:10px">
        <span class="pill">Status: <b id="statusTxt" class="ok">deslogado</b></span>
        <span class="pill">Token: <span id="tokenPreview" class="mono">—</span></span>
      </div>

      <div class="row">
        <input class="input mono" id="tokenInput" placeholder="Cole aqui o ADMIN_TOKEN (Netlify env var)" />
        <button class="btn" id="saveBtn">Salvar token</button>
        <button class="btn ghost" id="testBtn">Testar acesso</button>
      </div>

      <div class="small" style="margin-top:10px">
        Dica: se aparecer <span class="mono">unauthorized</span> ao abrir functions direto no navegador, é normal.
        O painel chama com token e resolve. <b>Se continuar “unauthorized” aqui</b>, falta criar a env var <span class="mono">ADMIN_TOKEN</span> no Netlify e redeploy.
      </div>

      <div class="msg mono" id="out">Pronto.</div>
    </div>

    <div class="grid">
      <div class="card span6">
        <h2>Eventos (WhatsAuto → Observatório)</h2>
        <div class="desc">Fluxo real de mensagens, status, filtros e sinais para debugging e melhoria de respostas.</div>
        <div class="actions">
          <button class="btn" onclick="openPage('events.html')">Abrir events.html</button>
          <span class="pill">URL: <span class="mono">/admin/events.html</span></span>
        </div>
      </div>

      <div class="card span6">
        <h2>Mídia (imagens / links / catálogo)</h2>
        <div class="desc">Cadastre aliases e links para respostas. Base para enviar “imagem por link” no WhatsAuto.</div>
        <div class="actions">
          <button class="btn" onclick="openPage('media.html')">Abrir media.html</button>
          <span class="pill">URL: <span class="mono">/admin/media.html</span></span>
        </div>
      </div>

      <div class="card span12">
        <h2>Regras (gatilhos / respostas)</h2>
        <div class="desc">Crie, edite, desative e exclua regras. Ajuste prioridade, tipo de match e teste respostas.</div>
        <div class="actions">
          <button class="btn" onclick="openPage('rules.html')">Abrir rules.html</button>
          <span class="pill">URL: <span class="mono">/admin/rules.html</span></span>
        </div>
      </div>
    </div>
  </div>

<script>
  const LS_KEY = "CONSYSENCIA_ADMIN_TOKEN_V1";

  function maskToken(t){
    if(!t) return "—";
    const s = String(t);
    if(s.length <= 8) return s;
    return s.slice(0,4) + "…" + s.slice(-4);
  }

  function setStatus(){
    const t = localStorage.getItem(LS_KEY) || "";
    document.getElementById("tokenPreview").textContent = maskToken(t);
    document.getElementById("statusTxt").textContent = t ? "logado" : "deslogado";
    document.getElementById("statusTxt").className = t ? "ok" : "danger";
    document.getElementById("tokenInput").value = t;
  }

  function out(msg, ok=true){
    const el = document.getElementById("out");
    el.textContent = msg;
    el.className = "msg mono " + (ok ? "" : "danger");
  }

  function openPage(p){ location.href = p; }

  async function api(path, body){
    const token = (localStorage.getItem(LS_KEY) || "").trim();
    const res = await fetch(path, {
      method: "POST",
      headers: {
        "content-type":"application/json",
        "authorization": token ? `Bearer ${token}` : ""
      },
      body: JSON.stringify(body || {})
    });
    const txt = await res.text();
    let j=null;
    try{ j = JSON.parse(txt); } catch(e){ j = { ok:false, error:"non_json", details: txt.slice(0,500) }; }
    return { ok: res.ok, status: res.status, j };
  }

  async function testAccess(){
    out("Testando…");
    const r = await api("/.netlify/functions/events_list", { limit: 5, offset: 0 });
    if(r.ok && r.j && r.j.ok){
      out("Acesso OK ✅ Functions respondendo. Você está pronto para operar o painel.");
    } else {
      out("Falha ❌ " + JSON.stringify(r.j), false);
    }
  }

  document.getElementById("saveBtn").onclick = () => {
    const t = (document.getElementById("tokenInput").value || "").trim();
    if(!t){ localStorage.removeItem(LS_KEY); setStatus(); out("Token removido."); return; }
    localStorage.setItem(LS_KEY, t);
    setStatus();
    out("Token salvo. Agora clique em “Testar acesso”.");
  };

  document.getElementById("testBtn").onclick = testAccess;

  document.getElementById("logoutBtn").onclick = () => {
    localStorage.removeItem(LS_KEY);
    setStatus();
    out("Deslogado.");
  };

  setStatus();
</script>
</body>
</html>
