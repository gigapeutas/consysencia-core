<!doctype html>
<html lang="pt-br">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ConSySencI.A — Painel</title>
  <style>
    :root{
      --bg:#070b0f;
      --bg2:#061a16;
      --card:#0b1217cc;
      --card2:#071015cc;
      --txt:#e9f1f0;
      --mut:#93a7a4;
      --green:#21ff8a;
      --green2:#00c978;
      --red:#ff4d6d;
      --line:#14302a;
      --shadow: 0 18px 60px rgba(0,0,0,.55);
      --r: 18px;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      color:var(--txt);
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial;
      background:
        radial-gradient(1000px 700px at 20% 20%, rgba(33,255,138,.12), transparent 60%),
        radial-gradient(900px 600px at 80% 30%, rgba(0,201,120,.10), transparent 55%),
        radial-gradient(700px 700px at 40% 90%, rgba(0,255,204,.06), transparent 55%),
        linear-gradient(180deg, var(--bg), #04070a 60%, #030507);
      min-height:100vh;
    }
    header{
      padding:22px 16px 10px;
      max-width:980px;
      margin:0 auto;
    }
    .brand{
      display:flex;
      align-items:center;
      gap:12px;
    }
    .dot{
      width:14px;height:14px;border-radius:99px;
      background:var(--green);
      box-shadow: 0 0 25px rgba(33,255,138,.45);
      flex:0 0 auto;
    }
    h1{
      margin:0;
      font-size:22px;
      letter-spacing:.2px;
    }
    .sub{
      margin:4px 0 0;
      color:var(--mut);
      font-size:13px;
      line-height:1.35;
    }

    .wrap{max-width:980px;margin:0 auto;padding:10px 16px 28px;}
    .grid{
      display:grid;
      grid-template-columns: 1fr;
      gap:14px;
    }
    @media (min-width: 880px){
      .grid{grid-template-columns: 1.1fr .9fr;}
    }

    .card{
      background: linear-gradient(180deg, rgba(10,18,22,.82), rgba(7,16,15,.70));
      border:1px solid rgba(20,48,42,.8);
      border-radius: var(--r);
      box-shadow: var(--shadow);
      padding:16px;
      position:relative;
      overflow:hidden;
    }
    .card::before{
      content:"";
      position:absolute; inset:-2px -2px auto -2px;
      height:70px;
      background: radial-gradient(400px 140px at 20% 30%, rgba(33,255,138,.16), transparent 60%);
      pointer-events:none;
      opacity:.9;
    }
    .card h2{
      margin:0 0 6px;
      font-size:18px;
    }
    .card p{
      margin:0 0 14px;
      color:var(--mut);
      font-size:13px;
      line-height:1.45;
    }

    .row{
      display:flex; gap:10px; flex-wrap:wrap; align-items:center;
    }
    .input{
      width:100%;
      padding:12px 14px;
      border-radius:14px;
      border:1px solid rgba(20,48,42,.9);
      background: rgba(3,7,9,.75);
      color:var(--txt);
      outline:none;
      font-size:14px;
    }
    .input::placeholder{color:#7f9893}
    .btn{
      border:1px solid rgba(33,255,138,.35);
      background: linear-gradient(180deg, rgba(6,28,22,.9), rgba(4,16,13,.85));
      color:var(--txt);
      padding:12px 14px;
      border-radius:16px;
      font-weight:700;
      letter-spacing:.2px;
      cursor:pointer;
      transition:.15s transform ease, .15s opacity ease, .15s border-color ease;
    }
    .btn:hover{transform: translateY(-1px); border-color: rgba(33,255,138,.6);}
    .btn:active{transform: translateY(0px); opacity:.9;}
    .btn.primary{
      border-color: rgba(33,255,138,.55);
      box-shadow: 0 0 0 2px rgba(33,255,138,.10) inset;
    }
    .btn.danger{
      border-color: rgba(255,77,109,.45);
      background: linear-gradient(180deg, rgba(30,10,14,.75), rgba(14,5,7,.70));
    }

    .pill{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding:10px 12px;
      border-radius: 999px;
      border:1px solid rgba(20,48,42,.9);
      background: rgba(3,7,9,.55);
      color: var(--mut);
      font-size:12px;
      user-select:none;
    }
    .ok{color: var(--green)}
    .bad{color: var(--red)}
    .mono{font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono","Courier New", monospace;}
    .small{font-size:12px;color:var(--mut);margin-top:10px;line-height:1.45;}
    .links{
      display:flex; gap:12px; flex-wrap:wrap; margin-top:10px;
    }
    .link{
      text-decoration:none;
      color:var(--green);
      font-weight:800;
      border-bottom:1px dashed rgba(33,255,138,.35);
      padding-bottom:2px;
    }
    .msg{
      margin-top:10px;
      padding:12px 12px;
      border-radius:14px;
      border:1px solid rgba(20,48,42,.9);
      background: rgba(3,7,9,.55);
      color:var(--mut);
      font-size:13px;
      line-height:1.45;
      white-space:pre-wrap;
    }
  </style>
</head>
<body>
  <header>
    <div class="brand">
      <div class="dot"></div>
      <div>
        <h1>ConSySencI.A — Painel</h1>
        <div class="sub">Gestão rápida de eventos, mídia e automações (admin). Tudo via POST + Authorization Bearer.</div>
      </div>
    </div>
  </header>

  <div class="wrap">
    <div class="grid">

      <div class="card">
        <h2>Login (Token Admin)</h2>
        <p>Cole seu token (sem “Bearer ”). Ele fica salvo neste navegador. Todas as chamadas do painel usam <span class="mono">Authorization: Bearer &lt;token&gt;</span>.</p>

        <div class="row">
          <input id="token" class="input mono" placeholder="Cole o token admin aqui (ex: 9f3a...)" autocomplete="off">
          <button class="btn primary" onclick="saveToken()">Salvar</button>
          <button class="btn danger" onclick="clearToken()">Limpar</button>
          <button class="btn" onclick="ping()">Testar</button>
        </div>

        <div style="margin-top:10px" class="row">
          <span class="pill">Status: <span id="status" class="mono">—</span></span>
          <span class="pill">Token: <span id="tokenState" class="mono">vazio</span></span>
        </div>

        <div id="log" class="msg" style="display:none"></div>

        <div class="small">
          Dica: se aparecer <span class="mono">unauthorized</span>, o token do painel não bate com o token esperado na function.<br/>
          Se aparecer <span class="mono">method_not_allowed</span>, o endpoint está bloqueando GET (correto) e você tentou abrir a function no navegador.
        </div>
      </div>

      <div class="card">
        <h2>Acessos</h2>
        <p>Abrir os módulos do painel.</p>

        <div class="card" style="padding:14px;margin:0;background:linear-gradient(180deg, rgba(11,18,23,.65), rgba(7,16,15,.55));">
          <h2 style="font-size:16px;margin:0 0 6px;">Eventos (WhatsAuto → Observatório)</h2>
          <p style="margin:0 0 12px;">Veja fluxo real de mensagens, status, filtros e sinais para debugging.</p>
          <div class="row">
            <a class="btn primary" href="/admin/events.html">Abrir events.html</a>
            <span class="pill">URL: <span class="mono">/admin/events.html</span></span>
          </div>
        </div>

        <div style="height:12px"></div>

        <div class="card" style="padding:14px;margin:0;background:linear-gradient(180deg, rgba(11,18,23,.65), rgba(7,16,15,.55));">
          <h2 style="font-size:16px;margin:0 0 6px;">Mídia (imagens / links / catálogo)</h2>
          <p style="margin:0 0 12px;">Cadastre aliases e links públicos (base pra enviar “imagem por link” via WhatsAuto).</p>
          <div class="row">
            <a class="btn primary" href="/admin/media.html">Abrir media.html</a>
            <span class="pill">URL: <span class="mono">/admin/media.html</span></span>
          </div>
        </div>

        <div class="small">
          Se você abrir <span class="mono">/admin/</span>, este Index deve carregar automaticamente.
        </div>
      </div>

    </div>
  </div>

  <script>
    const TOKEN_KEY = "consysencia_admin_token";

    function getToken(){ return localStorage.getItem(TOKEN_KEY) || ""; }
    function setToken(t){ localStorage.setItem(TOKEN_KEY, t); }
    function delToken(){ localStorage.removeItem(TOKEN_KEY); }

    function showLog(txt){
      const el = document.getElementById("log");
      el.style.display = "block";
      el.textContent = String(txt || "");
    }

    function setStatus(text, ok){
      const s = document.getElementById("status");
      s.textContent = text || "—";
      s.className = "mono " + (ok ? "ok" : (ok===false ? "bad" : ""));
      const t = getToken();
      document.getElementById("tokenState").textContent = t ? (t.slice(0,6) + "…" + t.slice(-4)) : "vazio";
    }

    async function api(path, body){
      const r = await fetch(path, {
        method: "POST",
        headers: {
          "content-type": "application/json",
          "authorization": "Bearer " + getToken()
        },
        body: JSON.stringify(body || {})
      });
      const j = await r.json().catch(()=>({ok:false,error:"invalid_json"}));
      return { status: r.status, j };
    }

    function saveToken(){
      const raw = (document.getElementById("token").value || "").trim();
      const t = raw.replace(/^Bearer\s+/i,"").trim();
      if(!t){ setStatus("token vazio", false); return; }
      setToken(t);
      setStatus("token salvo ✅", true);
      showLog("");
      ping();
    }

    function clearToken(){
      delToken();
      document.getElementById("token").value = "";
      setStatus("token limpo", false);
      showLog("");
    }

    async function ping(){
      setStatus("testando…", null);
      showLog("");
      const out = await api("/.netlify/functions/admin_ping", {});
      if(out.j && out.j.ok){
        setStatus("ok ✅ (" + out.j.now + ")", true);
      } else {
        const err = (out.j && out.j.error) ? out.j.error : ("http_" + out.status);
        setStatus("falhou ❌ " + err, false);
        showLog(JSON.stringify(out.j, null, 2));
      }
    }

    // boot
    (function init(){
      const t = getToken();
      if(t) document.getElementById("token").value = t;
      document.getElementById("tokenState").textContent = t ? (t.slice(0,6) + "…" + t.slice(-4)) : "vazio";
      setStatus("—", null);
    })();
  </script>
</body>
                                                                                         </html>
                                                                                         
